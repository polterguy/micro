!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("hyperlambda",function(){return{styles:{comment:"comment",string:"string",value:"property",keyword:"keyword",variable:"variable",activeevent:"variable-2",type:"def",expression:"number",error:"error",lambda:"variable-3"},indent:function(e,t){return e.indent},startState:function(){return{mode:"name",indent:0,previousIndent:0,noContent:!0}},token:function(e,t){switch(t.mode){case"name":return this.tokenizeNameMode(e,t);case"value":return this.tokenizeValueMode(e,t);case"mcomment":return this.tokenizeMultiCommentMode(e,t);case"mstring-name":return this.tokenizeMultilineStringMode(e,t,!0);case"mstring-value":return this.tokenizeMultilineStringMode(e,t,!1);case"error":return e.skipToEnd(),this.styles.error}},tokenizeNameMode:function(e,t){for(var n=0;" "==e.peek();)n+=1,e.next();var r=null,i=e.peek();switch(i){case'"':return t.noContent=!1,e.next(),!0===this.checkIndentation(t,n)?this.styles.error:this.parseSingleLineStringLiteral(e,t);case"@":if(!0===this.checkIndentation(t,n))return this.styles.error;if(t.noContent=!1,e.next(),'@"'==(i+=e.next()))return t.mode="mstring-name",t.oldIndent=t.indent,t.indent=0,this.tokenizeMultilineStringMode(e,t,!0);break;case":":return!0===this.checkIndentation(t,n)?this.styles.error:(t.noContent=!1,t.mode="value",this.styles.type);case"/":if(e.next(),"/"==e.peek())return t.indent=n,this.parseSingleLineComment(e,t);if("*"==e.peek())return t.oldIndent=n,t.indent=n+1,t.mode="mcomment",this.tokenizeMultiCommentMode(e,t)}if(e.next(),null!=i&&!0===this.checkIndentation(t,n))return this.styles.error;for(var o=i;;){if(null==(i=e.peek())){e.next();break}if(":"==i)break;e.next(),o+=i}return":"==i&&(t.mode="value",r=this.styles.type),t.noContent=!1,null!=o&&o.length>0&&(r=this.getNodeNameType(o,t)),r},tokenizeValueMode:function(e,t){if(!0===this.is_ex)return t.mode="name",this.is_ex=!1,this.parseLambdaExpression(e,t);var n=e.next(),r=this.styles.value;switch(n){case'"':return t.mode="name",this.parseSingleLineStringLiteral(e,t);case"@":if('"'==(n=e.peek()))e.next(),t.mode="mstring-value",t.oldIndent=t.indent,t.indent=0,r=this.tokenizeMultilineStringMode(e,t,!1);else for(t.mode="name";null!=e.next(););break;case":":r=this.styles.type,null==e.peek()&&(t.mode="name");break;default:for(;;){if(null==(n=e.next())){t.mode="name";break}if(":"==n){if(null==e.peek()){t.mode="name";break}"x"==e.string.substring(e.start,e.pos-1)&&(this.is_ex=!0),r=this.styles.type;break}}}return r},tokenizeMultiCommentMode:function(e,t){e.skipToEnd();var n=e.current();if(-1!=n.indexOf("*/",n.length-2))t.indent=t.oldIndent,t.mode="name";else if(-1!=n.indexOf("*/"))return t.mode="error",this.styles.error;return this.styles.comment},tokenizeMultilineStringMode:function(e,t,n){for(var r=e.next(),i=!1;null!=r;){if('"'==r&&'"'!=e.peek()){i=!0;break}if('"'==r){for(var o=r;'"'==r;)'"'==(r=e.peek())&&(o+=r,e.next());if(o.length%2==1){i=!0;break}}else r=e.next()}if(i){if(t.indent=t.oldIndent,r=e.peek(),!n&&null!=r)return t.mode="error",this.styles.error;if(null==r)t.mode="name";else{if(":"!=r)return t.mode="error",this.styles.error;t.mode="value"}}return this.styles.string},parseSingleLineStringLiteral:function(e,t){for(var n=e.next(),r="";;){if('"'==n&&"\\"!=r){if(e.eatSpace(),null!=e.peek()&&":"!=e.peek())return t.mode="error",e.skipToEnd(),this.styles.error;break}if(null==n)return t.mode="error",this.styles.error;r=n,n=e.next()}return this.styles.string},parseLambdaExpression:function(e,t){return e.skipToEnd(),this.styles.expression},parseSingleLineComment:function(e,t){return e.skipToEnd(),this.styles.comment},checkIndentation:function(e,t){return t%2!=0?(e.mode="error",!0):t-e.previousIndent>2||2==t&&!0===e.noContent?(e.mode="error",!0):(e.indent=t,e.previousIndent=t,!1)},getNodeNameType:function(t,n){return null!=e._hyperlambdaKeywords&&-1!=e._hyperlambdaKeywords.indexOf(t)?-1==t.indexOf(".")?this.styles.keyword:this.styles.activeevent:"_"==t[0]?this.styles.variable:"."==t[0]?this.styles.lambda:void 0}}}),e.defineMIME("text/x-hyperlambda","hyperlambda"),e.registerHelper("hint","hyperlambda",function(t,n){if(null!=e._hyperlambdaKeywords){for(var r=t.getCursor(),i=r.ch,o=[],s=t.getLine(r.line).trim(),l=i-s.length,a=0;a<e._hyperlambdaKeywords.length;a++)-1!=e._hyperlambdaKeywords[a].indexOf(s)&&o.push(e._hyperlambdaKeywords[a]);return{list:o,from:e.Pos(r.line,l),to:e.Pos(r.line,i)}}})});