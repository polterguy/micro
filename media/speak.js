(function(){p5.speech={};p5.speech._chain=[];p5.speech._push=function(n){p5.speech._chain.push(n)==1&&p5.speech._next()};p5.speech._voices=null;p5.speech._next=function(){var n=p5.speech._chain[0];n.do(function(){n.onfinish()==!0&&(p5.speech._chain.splice(0,1),p5.speech._chain.length!=0&&p5.speech._next())})};p5.speech.speak=function(n,t,i,r,u){p5.speech._push(new p5.speech._utter(n,t,i,r,u))};p5.speech._utter=function(n,t,i,r,u){this.ssu=new SpeechSynthesisUtterance(n);this.voice=t;this._onfinish=i;this.ssu.pitch=r;this.ssu.rate=u;this._handle=!0};p5.speech._utter.prototype.do=function(n){if(p5.speech._voices!=null)if(this.ssu.onend=function(){n()},this.ssu.voice=p5.speech._utter.findVoice(this.voice),this.ssu.voice!=null)window.speechSynthesis.speak(this.ssu);else throw"The voice '"+this.voice+"' was not found.";else{var t=this;p5.speech._queryVoices(function(){t.do(n)})}};p5.speech._utter.prototype.onfinish=function(){this._onfinish();var n=this._handle;return this._handle=!1,n};p5.speech._utter.prototype.stop=function(){this._handle=!1;window.speechSynthesis.cancel()};p5.speech._utter.findVoice=function(n){var t=n.split(","),i=p5.speech._voices.filter(function(n){return t.length==2?n.name==t[0]&&n.lang==t[1]:n.name==t[0]||n.lang==t[0]}),r;return i.length==0&&t.length==2&&(i=p5.speech._voices.filter(function(n){return n.lang==t[1]})),i.length==0&&(r=(t.length==2?t[1]:t[0]).split("-")[0],i=p5.speech._voices.filter(function(n){return n.lang.startsWith(r)})),i[0]};p5.speech.listen=function(n,t){p5.speech._push(new p5.speech._recognition(n,t))};p5.speech._recognition=function(n,t){this.lang=n;this._onfinish=t};p5.speech._recognition.prototype.do=function(n){if(this._rec=p5.speech._recognition.create_sr(),this._rec==null){this.recognised=window.prompt("Your browser doesn't support speech recognition. Hint; Google Chrome does!");n();return}this._rec.lang=this.lang;var t=this;this._handle=!0;this._rec.onresult=function(i){t.recognised=i.results[0][0].transcript;n();t._handle=!1};this._rec.onend=function(){t.recognised="";n();t._handle=!1};this._rec.start()};p5.speech._recognition.prototype.onfinish=function(){this._onfinish();var n=this._handle;return this._handle=!1,n};p5.speech._recognition.create_sr=function(){return window.SpeechRecognition==null&&window.webkitSpeechRecognition==null&&window.mozSpeechRecognition==null&&window.msSpeechRecognition==null?null:new(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition)};p5.speech._recognition.prototype.stop=function(){this._handle=!1;this._rec.abort()};p5.speech.queryVoices=function(n){p5.speech._push(new p5.speech.query_voices(n))};p5.speech.query_voices=function(n){this.widget=n};p5.speech.query_voices.prototype.do=function(n){var t=this;p5.speech._queryVoices(function(){t.onfinish();n()})};p5.speech.query_voices.prototype.onfinish=function(){return p5.$(this.widget).raise(".onfinish",{onbefore:function(n){for(var i,t=0;t<p5.speech._voices.length;t++)i=p5.speech._voices[t],n.push(["p5-speech-voice."+i.name,i.lang+","+i.localService])}}),!0};p5.speech._queryVoices=function(n){if(p5.speech._voices){n();return}var t=function(){p5.speech._voices=window.speechSynthesis.getVoices();p5.speech._voices&&p5.speech._voices.length>0&&n()};window.speechSynthesis.onvoiceschanged!==undefined?(window.speechSynthesis.onvoiceschanged=function(){t()},t()):t()};p5.speech.stop=function(){if(p5.speech._chain.length!=0){var n=p5.speech._chain[0];p5.speech._chain=[];n.stop!==undefined&&n.stop()}};window.addEventListener("beforeunload",p5.speech.stop)})()