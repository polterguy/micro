(function(){p5.dropzone=function(n,t,i,r,u,f,e,o){this._cssClass=document.body.className;this._hoverClass=n;this._dropClass=t;this._errorClass=i;this._filter=r==""?[]:r.split("|");this._multiple=u;this._url=f;this._onfinish=e;this._onbegin=o;this._file=p5.$("micro-page-dropzone-file").el;var s=this;this._file.addEventListener("change",function(){s.onFileInputChanged()});document.body.addEventListener("drop",function(n){s.onDrop(n)},!1);document.body.addEventListener("dragover",function(n){s.onDragOver(n)},!1);document.body.addEventListener("dragleave",function(n){s.onDragLeave(n)},!1);p5.dropzone.instance=this};p5.dropzone.browse=function(){p5.dropzone.instance._file.value=null;p5.dropzone.instance._file.click()};p5.dropzone.prototype.onFileInputChanged=function(){this.uploadFiles(this._file.files)};p5.dropzone.prototype.onDrop=function(n){n.preventDefault();this.uploadFiles(n.dataTransfer.files)};p5.dropzone.prototype.uploadFiles=function(n){var u,t,i,r;if(this.checkFile(n)){if(n.length>0){document.body.className=this._cssClass+" "+this._dropClass;function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})}this._onbegin();var u=this,h=n.length,f=0,e=0,o=s();for(t=0;t<n.length;t++)i=new XMLHttpRequest,r=new FormData,i.open("POST",this._url,!0),i.onreadystatechange=function(){this.readyState==XMLHttpRequest.DONE&&this.status==200&&(document.body.className=this._cssClass,this.responseText==="ERROR"&&(e+=1),++f==h&&u._onfinish(o,f,e))},r.append("file",n[t]),r.append("batch",o),i.send(r)}}else document.body.el.className=this._cssClass+" "+this._errorClass,u=this,setTimeout(function(){document.body.className=u._cssClass},1e3)};p5.dropzone.prototype.onDragLeave=function(n){n.preventDefault();document.body.className=this._cssClass};p5.dropzone.prototype.onDragOver=function(n){var t=n.dataTransfer;t.types&&(t.types.indexOf?t.types.indexOf("Files")!=-1:t.types.contains("Files"))&&(n.preventDefault(),document.body.className=this._cssClass+" "+this._hoverClass)};p5.dropzone.prototype.checkFile=function(n){var t,i;if(this._multiple===!1&&n.length>1)return!1;if(this._filter.length==0)return!0;for(t=0;t<n.length;t++){var r=n[t].name.split("."),f=r[r.length-1],u=!1;for(i=0;i<this._filter.length;i++)if(this._filter[i]==f){u=!0;break}if(!u)return!1}return!0}})()